(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;B="http://copypasta.heroku.com",e=document.createElement("link"),e.rel="stylesheet",e.href=B+"/stylesheets/compiled/copypasta.css",document.documentElement.childNodes[0].appendChild(e),a=false,g=false,f=false,k={},d={$:false,page_id:copypasta_page_id},d.debug=window.copypasta_debug||window.location.hash.indexOf("debug")>0,d.debug&&(window.copypasta=d),i=function(a){if(d.debug)return console.debug(a)},n={indicator:"copy-pasta-edit-indicator",dialog:"copy-pasta-dialog",iframe:"copy-pasta-iframe",cancel_btn:"copy-pasta-cancel",overlay:"copy-pasta-overlay"},t={indicator:"#"+n.indicator,dialog:"#"+n.dialog,btn:".copy-pasta-button",active:".copy-pasta-active",cancel_btn:"#"+n.cancel_btn,iframe:"#"+n.iframe,overlay:"#"+n.overlay},c="<div id=\""+n.dialog+"\" class=\"copy-pasta-loading\"><div id=\""+n.overlay+"\"></div><iframe frameborder=\"no\"id=\""+n.iframe+"\" scrolling=\"no\"></iframe><input type=\"button\" class=\"close\" id=\""+n.cancel_btn+"\" style=\"display:none;\"></div>",p=function(){a(t.indicator).length===0&&a("body").append("<div id=\""+n.indicator+"\"><p>click to correct</p></div>");return a(t.indicator)},j=function(b){a(t.dialog).length===0&&a("body").append(c),b!=null&&(a(t.overlay).show(),i("Overlay shown"),b=b+"&"+Math.random(),d.debug&&(b+="#debug"),a(t.iframe).attr("src",b));return a(t.dialog)},l=function(){return j().find(t.cancel_btn).click()},m=function(){return a(t.overlay).fadeOut(function(){return i("Overlay hidden")})},w=function(a){return j().animate({height:a.h+"px"})},b=function(){var b,c;b=a(this).offset(),b.top=b.top+"px",b.left=b.left+"px",c={width:a(this).outerWidth()+"px",height:a(this).outerHeight()+"px"},p().css(c).css(b).show();return g=this},h=function(){p().hide();return g=false},C=function(c){return a(t.active+" "+c).live("mouseover",b)},r=function(){return A("copy-pasta-lightbox").lightbox_me()},A=function(a){var b,c,e;c=g,(e=c.original_text)!=null?e:c.original_text=c.innerHTML,p().addClass("loading"),k.new_edit={"edit[original]":c.original_text,"edit[proposed]":c.original_text,"edit[url]":window.location.href,"edit[element_path]":d.getElementCssPath(c,f)},b=j("http://copypasta.heroku.com/edits/new?view=framed&url="+escape(window.location.href)+"&page[key]="+escape(d.page_id)),a!=null&&b.attr("class",a);return b},s=function(a){if(a!=null&&k[a]!=null)return z({label:"form_data",data:k[a]})},z=function(b){i("Parent send: "+b.label+" to http://copypasta.heroku.com"),b=JSON.stringify(b);return a(t.iframe).get(0).contentWindow.postMessage(b,"http://copypasta.heroku.com")},v=function(a){var b;if(a.origin!=="http://copypasta.heroku.com")i(a);else{b=JSON.parse(a.data),i("Parent receive: "+b.label+" from "+a.origin);if(b.label==="ready"){if(!s(b.form_id))return m()}else{if(b.label==="form_data_loaded")return m();if(b.label==="finished")return l();if(b.label==="resize")return w(b)}}},q=function(){var b,c,d,e;lightbox_me_init(a),e=["p","li","h1","h2","h3","h4","h5"];for(c=0,d=e.length;c<d;c++)b=e[c],C(b);a(t.indicator).live("mouseout",h),a(t.indicator).live("click",r),a(t.btn+".off").live("click",function(){var b;o.load(),b=a(this),b.removeClass("off").addClass("on");return f=a(b.attr("href")).addClass("copy-pasta-active").get(0)}),a(t.btn+".on").live("click",function(){var b;b=a(this),b.removeClass("on").addClass("off"),a(b.attr("href")).removeClass("copy-pasta-active");return f=false});if(window.addEventListener!=null)return window.addEventListener("message",v,false);if(window.attachEvent!=null)return window.attachEvent("onmessage",function(){return v(event)})},y=[{test:function(){return window.jQuery&&window.jQuery.fn&&window.jQuery.fn.jquery>"1.4.2"},src:"http://copypasta.heroku.com/javascripts/jquery-1.4.2.min.js",callback:function(){return(d.$=a=window.jQuery).noConflict(1)}},{test:function(){return window.jQuery&&window.jQuery.fn.lightbox_me},src:"http://copypasta.heroku.com/javascripts/utils.min.js"},{test:function(){return window.JSON},src:"http://copypasta.heroku.com/javascripts/json2.min.js"}],y.load=function(a,b){var c,d,e,f;e=function(){var b,c,e;e=[];for(b=0,c=a.length;b<c;b++)d=a[b],d.state!=null||e.push(d);return e}();if(!(e.length===0)){c=e.pop(),c.state="pending",f=document.createElement("script"),f.type="text/javascript",f.src=c.src,f.onload=f.onreadystatechange=function(){var d,f;d=this.readyState;if(!c.loaded&&(!d||d==="loaded"||d==="complete")){c.state="loaded",c.callback!=null&&c.callback(),e=function(){var b,c,d;d=[];for(b=0,c=a.length;b<c;b++)f=a[b],f.state!=="loaded"&&d.push(f);return d}();if(e.length===0)return b()}},a.length>0&&y.load(a,b);return document.documentElement.childNodes[0].appendChild(f)}},o=["translucent-black.png","translucent-blue.png","loading.gif"],o.load=function(){var a,b,c,d,e;e=[];for(c=0,d=o.length;c<d;c++)a=o[c],b=new Image,e.push(b.src=B+"/images/"+a);return e},u=function(){var a,b,c;c=[];for(a=0,b=y.length;a<b;a++)x=y[a],x!=null&&!x.test()&&c.push(x);return c}(),u.length>0?y.load(u,q):q()}).call(this)