(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S;Q=window;Q.postMessage&&(b=function(){var a,b,c,d;c=document.documentElement.childNodes,d=[];for(a=0,b=c.length;a<b;a++)l=c[a],l.nodeType===1&&d.push(l);return d}()[0],w="https://copypasta.heroku.com",P="http://copypasta.credibl.es",g=document.createElement("link"),g.rel="stylesheet",g.href=P+"/stylesheets/compiled/copypasta.css",b.appendChild(g),a=false,i=false,h=false,q={},Q.copypasta=e={$:false,page_id:Q.copypasta_page_id},e.debug=Q.copypasta_debug||Q.location.hash.indexOf("copypasta-debug")>0,e.auto_start=Q.copypasta_auto_start||Q.location.hash.indexOf("copypasta-auto")>0,e.include_url_hash=Q.copypasta_include_url_hash,e.content_selector=Q.copypasta_content_selector,e.paragraph_threshold=Q.copypasta_paragraph_threshold||3,e.character_threshold=Q.copypasta_character_threshold||100,C=function(){var a,b,c,d,f,g,h,i;a=[],c=false,f=0,d=0,i=document.getElementsByTagName("p");for(g=0,h=i.length;g<h;g++)b=i[g],c!==b.parentElement&&((f>=e.paragraph_threshold||d>e.character_threshold)&&a.push(c),c=b.parentElement,f=0,d=b.innerText.length),f+=1,d+=b.innerText.length;(f>=e.paragraph_threshold||d>e.character_threshold)&&a.push(c);return a},j=function(a){if(e.debug)return console.debug(a)},v={indicator:"copy-pasta-edit-indicator",dialog:"copy-pasta-dialog",iframe:"copy-pasta-iframe",btn:"copy-pasta-button",widget:"copy-pasta-widget"},E={indicator:"#"+v.indicator,dialog:"#"+v.dialog,btn:"#"+v.btn,active:".copy-pasta-active",iframe:"#"+v.iframe,overlay:".copy-pasta-overlay",status:"#copy-pasta-button .status",widget:"#"+v.widget,widget_iframe:"#"+v.widget+" iframe"},y=function(){a(E.indicator).length===0&&(a("body").append("<div id=\""+v.indicator+"\"><p>click to correct</p></div>"),a(E.indicator).bind("mouseout",deactivate),a(E.indicator).bind("click",M));return a(E.indicator)},D=function(b){a(b).prev(E.overlay).length===0&&a(b).before("<div class=\"copy-pasta-overlay\"></div>");return a(b).prev(E.overlay)},f=function(b,c){var d;d={width:a(b).outerWidth()+"px",height:a(b).outerHeight()+"px"},c||(c=D(b).fadeIn());return a(c).css(d)},p=function(){var b,c;b=Q.location.hash,e.include_url_hash?Q.location.hash=Q.location.hash.replace(/#?copypasta-[a-z]+/g,""):Q.location.hash="",c=a("link[rel=canonical]").attr("href")||Q.location.href.replace(/#+$/,""),Q.location.hash=b;return c},c=function(a){return"<div id=\""+v.dialog+"\" class=\""+a+"\"><iframe frameborder=\"no\" id=\""+v.iframe+"\" scrolling=\"no\"></iframe></div>"},H=function(b,c){return a(b).animate({height:c.h})},M=function(){var b,c,d,f;l=i,(d=l.original_text)!=null?d:l.original_text=l.innerHTML,b=(f=e.page_id)!=null?f:"",q.new_edit={"edit[original]":l.original_text,"edit[proposed]":l.original_text,"edit[url]":p(),"edit[element_path]":e.getElementCssPath(l)},c=w+"/edits/new?view=framed&url="+escape(p())+"&page[key]="+escape(b),a(E.widget).hide();return L(c,"edit")},k={"default":{options:{escClose:true,overlayClose:true,overlayId:"copy-pasta-lightbox-overlay",containerId:"copy-pasta-lightbox-container",opacity:70,persist:true}},edit:{"class":"copy-pasta-lightbox"}},L=function(b,d){var g;a.fn.modal||e.modal_init(a);if(a.modal&&a("#copy-pasta-lightbox-container").length>0){a.modal.close();return setTimeout(function(){return L(b,d)},11)}g=k["default"],g.options.onShow=function(){if(b){f(E.iframe),j("Overlay shown"),b=b,e.debug&&(b+="#debug"),j("Loading iframe: "+b);return a(E.iframe).attr("src",b)}},d&&k[d]&&(g=k[d],g.options||(g.options={}),g.extended||(g.options=a.extend(g.options,k["default"].options)),g.extended=true);return a.modal(c(g["class"]),g.options)},S=function(){var a,b,c;a=(c=e.page_id)!=null?c:"";return b=w+"/edits?view=framed&url="+escape(p())+"&page[key]="+escape(a)},d="<div id=\""+v.widget+"\"><h1>copypasta</h1><iframe frameborder=\"no\" scrolling=\"no\"></iframe></div>",R=function(b){var c;a(E.widget).length===0&&(a("body").append(d),b==null&&(b=S())),b!=null&&(c=a(E.widget).find("iframe").attr("src",b),f(c));return a(E.widget).show()},N=function(b){var c,d,e;j("Previewing "+b.element_path),e=a(b.element_path),c=e.position(),e.get(0).original_text||(e.get(0).original_text=e.html()),d=a("html").scrollTop(1)>0?"html":"body";return a(d).animate({scrollTop:c.top},function(){return e.html(b.proposed).addClass("copy-pasta-preview")})},t=function(b){var c;c=a(b);return c.removeClass("copy-pasta-preview").html(c.get(0).original_text)},u=function(){return a(".copy-pasta-preview").each(function(){var b,c;b=(c=this.original_text)!=null?c:a(this).html();return a(this).removeClass("copy-pasta-preview").html(b)})},A=function(b){var c,d,e,f;d=a(window).scrollTop(),c=d+a(window).height(),f=a(b).offset().top,e=f+a(b).height();return e>=d&&f<=c&&e<=c&&f>=d},B=function(a){if(a&&q[a])return K({label:"form_data",data:q[a]})},K=function(b){j("Parent send: "+b.label+" to "+w),b=JSON.stringify(b);return a(E.iframe).get(0).contentWindow.postMessage(b,w)},G=function(a){var b;if(a.origin!==w)j(a);else{b=JSON.parse(a.data),j("Parent receive: "+b.label+" from "+a.origin+" for frame type: "+b.frame_type);return b.frame_type==="dialog"?r(b):s(b)}},s=function(a){if(a.label==="ready")return D(E.widget_iframe).fadeOut();if(a.label==="loading")return f(E.widget_iframe);if(a.label==="resize")return H(E.widget+" iframe",a);if(a.label==="finished")return o();if(a.label==="preview")return N(a);if(a.label==="preview-off")return t(a.element_path)},r=function(b){if(b.label==="ready"){if(!B(b.form_id))return D(E.iframe).fadeOut()}else{if(b.label==="form_data_loaded")return D(E.iframe).fadeOut();if(b.label==="finished"){a.modal&&a.modal.close(),u();return R().show()}if(b.label==="resize")return H(E.dialog,b)}},n="p, h1, h2, h3, h4, h5, td, th, li",m=function(a){if(!(a instanceof HTMLAnchorElement)){i=this,M();return false}},e.start_editing=O=function(){var b;x.load(),a(E.btn).addClass("on"),b=a(h).addClass("copy-pasta-active").find(n).filter(":visible"),b.addClass("copy-pasta-editable").bind("click",m);return R()},o=function(){a(E.btn).removeClass("on"),u(),a(h).removeClass("copy-pasta-active"),a(".copy-pasta-editable").removeClass("copy-pasta-editable").unbind("click",m);return R().remove()},z=function(){e.content_selector?h=a(e.content_selector):h=a(C()),e.auto_start&&O(),a(E.btn).live("click",function(){return a(this).hasClass("on")?o():O()}),a(E.btn+" .status").live("click",function(){return false});if(Q.addEventListener)return Q.addEventListener("message",G,false);if(Q.attachEvent)return Q.attachEvent("onmessage",function(){return G(event)})},J=[{test:function(){if(Q.jQuery&&Q.jQuery.fn&&Q.jQuery.fn.jquery>"1.3"){e.$=a=Q.jQuery,j("Using existing jquery: version "+a.fn.jquery);return true}},src:"http://copypasta.credibl.es/javascripts/jquery-1.4.4.min.js",callback:function(){(e.$=a=Q.jQuery).noConflict(1);return j("Loaded own jquery: version "+a.fn.jquery)}},{test:function(){return e.getElementCssPath&&Q.jQuery&&Q.jQuery.fn.lightbox_me},src:"http://copypasta.credibl.es/javascripts/utils.js"}],J.load=function(a,c){var d,e,f,g;f=function(){var b,c,d;d=[];for(b=0,c=a.length;b<c;b++)e=a[b],e.state||d.push(e);return d}();if(!(f.length===0)){d=f.pop(),d.state="pending",g=document.createElement("script"),g.type="text/javascript",g.src=d.src,g.onload=g.onreadystatechange=function(){var b,e;b=this.readyState;if(d.state!=="loaded"&&(!b||b==="loaded"||b==="complete")){d.state="loaded",d.callback&&d.callback(),f=function(){var b,c,d;d=[];for(b=0,c=a.length;b<c;b++)e=a[b],e.state!=="loaded"&&d.push(e);return d}();if(f.length===0)return c()}},a.length>0&&J.load(a,c);return b.appendChild(g)}},x=["translucent-blue.png","translucent-black.png","translucent-black-85.png","loading.gif","pencil.png"],x.load=function(){var a,b,c,d,e;e=[];for(c=0,d=x.length;c<d;c++)a=x[c],b=new Image,e.push(b.src=P+"/images/"+a);return e},F=function(){var a,b,c;c=[];for(a=0,b=J.length;a<b;a++)I=J[a],I&&!I.test()&&c.push(I);return c}(),F.length>0?J.load(F,z):z())}).call(this)