(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;L=window;L.postMessage&&(c=function(){var a,b,c,d;c=document.documentElement.childNodes,d=[];for(a=0,b=c.length;a<b;a++)l=c[a],l.nodeType===1&&d.push(l);return d}()[0],s="https://copypasta.heroku.com",K="http://copypasta.heroku.com",f=document.createElement("link"),f.rel="stylesheet",f.href=K+"/stylesheets/compiled/copypasta.css",c.appendChild(f),a=false,h=false,g=false,n={},L.copypasta=e={$:false,page_id:L.copypasta_page_id},e.debug=L.copypasta_debug||L.location.hash.indexOf("copypasta-debug")>0,e.auto_start=L.copypasta_auto_start||L.location.hash.indexOf("copypasta-auto")>0,e.include_url_hash=L.copypasta_include_url_hash||false,j=function(a){if(e.debug)return console.debug(a)},r={indicator:"copy-pasta-edit-indicator",dialog:"copy-pasta-dialog",iframe:"copy-pasta-iframe",overlay:"copy-pasta-overlay",btn:"copy-pasta-button"},y={indicator:"#"+r.indicator,dialog:"#"+r.dialog,btn:"#"+r.btn,active:".copy-pasta-active",iframe:"#"+r.iframe,overlay:"#"+r.overlay,status:"#copy-pasta-button .status"},u=function(){a(y.indicator).length===0&&(a("body").append("<div id=\""+r.indicator+"\"><p>click to correct</p></div>"),a(y.indicator).bind("mouseout",i),a(y.indicator).bind("click",H));return a(y.indicator)},b=function(){var b,c;b=a(this).offset(),b.top=b.top+"px",b.left=b.left+"px",c={width:a(this).outerWidth()+"px",height:a(this).outerHeight()+"px"},u().css(c).css(b).show();return h=this},i=function(){u().hide();return h=false},M=function(c){return a(y.active+" "+c).live("mouseover",b)},m=function(){var b,c;b=L.location.hash,e.include_url_hash?L.location.hash=L.location.hash.replace(/#?copypasta-[a-z]+/g,""):L.location.hash="",c=a("link[rel=canonical]").attr("href")||L.location.href.replace(/#+$/,""),L.location.hash=b;return c},d=function(a){return"<div id=\""+r.dialog+"\" class=\""+a+"\"><div id=\""+r.overlay+"\"></div><iframe frameborder=\"no\" id=\""+r.iframe+"\" scrolling=\"no\"></iframe></div>"},G=function(){return a(y.overlay).fadeIn(function(){return j("Overlay shown")})},o=function(){return a(y.overlay).fadeOut(function(){return j("Overlay hidden")})},B=function(b){return a(y.dialog).animate({height:b.h})},H=function(){var a,b,c,d;l=h,(c=l.original_text)!=null?c:l.original_text=l.innerHTML,a=(d=e.page_id)!=null?d:"",n.new_edit={"edit[original]":l.original_text,"edit[proposed]":l.original_text,"edit[url]":m(),"edit[element_path]":e.getElementCssPath(l,g)},b=s+"/edits/new?view=framed&url="+escape(m())+"&page[key]="+escape(a);return F(b,"edit")},J=function(){var a,b,c;a=(c=e.page_id)!=null?c:"",b=s+"/edits?view=framed&url="+escape(m())+"&page[key]="+escape(a);return F(b,"info")},k={"default":{options:{escClose:true,overlayClose:true,overlayId:"copy-pasta-lightbox-overlay",containerId:"copy-pasta-lightbox-container",opacity:70,persist:true}},edit:{"class":"copy-pasta-lightbox"},info:{"class":"copy-pasta-widget",options:{modal:false,position:[100,"0%"]}}},F=function(b,c){var f;a.fn.modal||e.modal_init(a);if(a.modal&&a("#copy-pasta-lightbox-container").length>0){a.modal.close();return setTimeout(function(){return F(b,c)},11)}f=k["default"],f.options.onShow=function(){if(b){a(y.overlay).show(),j("Overlay shown"),b=b,e.debug&&(b+="#debug"),j("Loading iframe: "+b);return a(y.iframe).attr("src",b)}},c&&k[c]&&(f=k[c],f.options||(f.options={}),f.extended||(f.options=a.extend(f.options,k["default"].options)),f.extended=true);return a.modal(d(f["class"]),f.options)},I=function(b){var c,d,e;j("Previewing "+b.element_path),e=a(g).find(b.element_path),c=e.position(),e.get(0).original_text||(e.get(0).original_text=e.html()),d=a("html").scrollTop(1)>0?"html":"body";return a(d).animate({scrollTop:c.top},function(){return e.html(b.proposed).addClass("copy-pasta-preview")})},p=function(b){var c;c=a(g).find(b);return c.removeClass("copy-pasta-preview").html(c.get(0).original_text)},q=function(){return a(".copy-pasta-preview").each(function(){var b,c;b=(c=this.original_text)!=null?c:a(this).html();return a(this).removeClass("copy-pasta-preview").html(b)})},w=function(b){var c,d,e,f;d=a(window).scrollTop(),c=d+a(window).height(),f=a(b).offset().top,e=f+a(b).height();return e>=d&&f<=c&&e<=c&&f>=d},x=function(a){if(a&&n[a])return E({label:"form_data",data:n[a]})},E=function(b){j("Parent send: "+b.label+" to "+s),b=JSON.stringify(b);return a(y.iframe).get(0).contentWindow.postMessage(b,s)},A=function(b){var c;if(b.origin!==s)j(b);else{c=JSON.parse(b.data),j("Parent receive: "+c.label+" from "+b.origin);if(c.label==="ready"){if(!x(c.form_id))return o()}else{if(c.label==="form_data_loaded")return o();if(c.label==="preview")return I(c);if(c.label==="preview-off")return p(c.element_path);if(c.label==="finished"){a.modal&&a.modal.close();return q()}if(c.label==="resize")return B(c)}}},v=function(){var b,c,d,f;f=["p","li","h1","h2","h3","h4","h5"];for(c=0,d=f.length;c<d;c++)b=f[c],M(b);e.auto_start&&(g=a(a(y.btn).attr("href")||"body").addClass("copy-pasta-active").get(0),J()),a(y.btn+".off").live("click",function(){var b;if(a(this).hasClass("on")){b=a(this),b.removeClass("on");return a(b.attr("href")).removeClass("copy-pasta-active")}t.load(),b=a(this),b.addClass("on");return g=a(b.attr("href")||"body").addClass("copy-pasta-active").get(0)}),a(y.btn+" .status").live("click",function(){var b;b=a(this).parent().attr("href")||"body",g=a(b).get(0),J();return false});if(L.addEventListener)return L.addEventListener("message",A,false);if(L.attachEvent)return L.attachEvent("onmessage",function(){return A(event)})},D=[{test:function(){if(L.jQuery&&L.jQuery.fn&&L.jQuery.fn.jquery>"1.3"){a=L.jQuery,j("Using existing jquery: version "+a.fn.jquery);return true}},src:"http://copypasta.heroku.com/javascripts/jquery-1.4.4.min.js",callback:function(){(e.$=a=L.jQuery).noConflict(1);return j("Loaded own jquery: version "+a.fn.jquery)}},{test:function(){return e.getElementCssPath&&L.jQuery&&L.jQuery.fn.lightbox_me},src:"http://copypasta.heroku.com/javascripts/utils.js"}],D.load=function(a,b){var d,e,f,g;f=function(){var b,c,d;d=[];for(b=0,c=a.length;b<c;b++)e=a[b],e.state||d.push(e);return d}();if(!(f.length===0)){d=f.pop(),d.state="pending",g=document.createElement("script"),g.type="text/javascript",g.src=d.src,g.onload=g.onreadystatechange=function(){var c,e;c=this.readyState;if(d.state!=="loaded"&&(!c||c==="loaded"||c==="complete")){d.state="loaded",d.callback&&d.callback(),f=function(){var b,c,d;d=[];for(b=0,c=a.length;b<c;b++)e=a[b],e.state!=="loaded"&&d.push(e);return d}();if(f.length===0)return b()}},a.length>0&&D.load(a,b);return c.appendChild(g)}},t=["translucent-blue.png","translucent-black.png","loading.gif"],t.load=function(){var a,b,c,d,e;e=[];for(c=0,d=t.length;c<d;c++)a=t[c],b=new Image,e.push(b.src=K+"/images/"+a);return e},z=function(){var a,b,c;c=[];for(a=0,b=D.length;a<b;a++)C=D[a],C&&!C.test()&&c.push(C);return c}(),z.length>0?D.load(z,v):v())}).call(this)