(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;M=window;M.postMessage&&(c=function(){var a,b,c,d;c=document.documentElement.childNodes,d=[];for(a=0,b=c.length;a<b;a++)m=c[a],m.nodeType===1&&d.push(m);return d}()[0],t="https://copypasta.heroku.com",L="http://copypasta.heroku.com",g=document.createElement("link"),g.rel="stylesheet",g.href=L+"/stylesheets/compiled/copypasta.css",c.appendChild(g),a=false,i=false,h=false,o={},M.copypasta=e={$:false,page_id:M.copypasta_page_id},e.debug=M.copypasta_debug||M.location.hash.indexOf("copypasta-debug")>0,e.auto_start=M.copypasta_auto_start||M.location.hash.indexOf("copypasta-auto")>0,e.include_url_hash=M.copypasta_include_url_hash||false,k=function(a){if(e.debug)return console.debug(a)},s={indicator:"copy-pasta-edit-indicator",dialog:"copy-pasta-dialog",iframe:"copy-pasta-iframe",overlay:"copy-pasta-overlay",btn:"copy-pasta-button"},A={indicator:"#"+s.indicator,dialog:"#"+s.dialog,btn:"#"+s.btn,active:".copy-pasta-active",iframe:"#"+s.iframe,overlay:"#"+s.overlay,status:"#copy-pasta-button .status"},f=function(b,c){var d,e;d=a(b).offset(),d.top=d.top+"px",d.left=d.left+"px",e={width:a(b).outerWidth()+"px",height:a(b).outerHeight()+"px"};return a(c).css(e).css(d).show()},x=["font-family","font-size","line-height","padding","background-color","color","height","width"],d=function(a){return"<div id=\""+s.dialog+"\" class=\""+a+"\"><div id=\""+s.overlay+"\"></div><iframe frameborder=\"no\"id=\""+s.iframe+"\" scrolling=\"no\"></iframe></div>"},l=function(b,c){b!=null&&a(A.dialog).remove(),a(A.dialog).length===0&&a("body").append(d),c!=null&&a(A.dialog).attr("class",c),b!=null&&(a(A.overlay).show(),a(A.iframe).attr("src",b));return a(A.dialog)},v=function(){a(A.indicator).length===0&&(a("body").append("<div id=\""+s.indicator+"\"><p>click to correct</p></div>"),a(A.indicator).bind("mouseout",j),a(A.indicator).bind("click",I));return a(A.indicator)},b=function(){f(this,v());return i=this},j=function(){v().hide();return i=false},N=function(c){return a(A.active+" "+c).live("mouseover",b)},n=function(){var b,c;b=M.location.hash,e.include_url_hash?M.location.hash=M.location.hash.replace(/#?copypasta-[a-z]+/g,""):M.location.hash="",c=a("link[rel=canonical]").attr("href")||M.location.href.replace(/#+$/,""),M.location.hash=b;return c},H=function(){return a(A.overlay).fadeIn(function(){return k("Overlay shown")})},p=function(){return a(A.overlay).fadeOut(function(){return k("Overlay hidden")})},D=function(b){return a(A.dialog).animate({height:b.h})},I=function(){var b,c,d,g,j,p;m=i,(j=m.original_text)!=null?j:m.original_text=m.innerHTML,b=(p=e.page_id)!=null?p:"",o.new_edit={"edit[original]":m.original_text,"edit[proposed]":m.original_text,"edit[url]":n(),"edit[element_path]":e.getElementCssPath(m,h)},d=function(){var b,d,e;e=[];for(b=0,d=x.length;b<d;b++)c=x[b],e.push(c+":"+a(m).css(c));return e}().join(";"),k("Found style: "+d),g=t+"/edits/new?view=framed&url="+escape(n())+"&page[key]="+escape(b)+"&style="+escape(d),v().hide(),a(m).addClass("copy-pasta-being-edited");return f(m,l(g,"copy-pasta-inline"))},K=function(){var a,b,c;a=(c=e.page_id)!=null?c:"",b=t+"/edits?view=framed&url="+escape(n())+"&page[key]="+escape(a);return l(b,"copy-pasta-widget").fadeIn()},J=function(b){var c,d,e;k("Previewing "+b.element_path),e=a(h).find(b.element_path),c=e.position(),e.get(0).original_text||(e.get(0).original_text=e.html()),d=a("html").scrollTop(1)>0?"html":"body";return a(d).animate({scrollTop:c.top},function(){return e.html(b.proposed).addClass("copy-pasta-preview")})},q=function(b){var c;c=a(h).find(b);return c.removeClass("copy-pasta-preview").html(c.get(0).original_text)},r=function(){return a(".copy-pasta-preview").each(function(){var b,c;b=(c=this.original_text)!=null?c:a(this).html();return a(this).removeClass("copy-pasta-preview").html(b)})},y=function(b){var c,d,e,f;d=a(window).scrollTop(),c=d+a(window).height(),f=a(b).offset().top,e=f+a(b).height();return e>=d&&f<=c&&e<=c&&f>=d},z=function(a){if(a&&o[a])return G({label:"form_data",data:o[a]})},G=function(b){k("Parent send: "+b.label+" to http://copypasta.heroku.com"),b=JSON.stringify(b);return a(A.iframe).get(0).contentWindow.postMessage(b,"http://copypasta.heroku.com")},C=function(b){var c;if(b.origin!=="http://copypasta.heroku.com")k(b);else{c=JSON.parse(b.data),k("Parent receive: "+c.label+" from "+b.origin);if(c.label==="ready"){if(!z(c.form_id))return p()}else{if(c.label==="form_data_loaded")return p();if(c.label==="preview")return J(c);if(c.label==="preview-off")return q(c.element_path);if(c.label==="finished"){l().remove(),a(".copy-pasta-being-edited").removeClass("copy-pasta-being-edited");return r()}if(c.label==="resize")return D(c)}}},w=function(){var b,c,d,f;f=["p","li","h1","h2","h3","h4","h5"];for(c=0,d=f.length;c<d;c++)b=f[c],N(b);e.auto_start&&(h=a("body").addClass("copy-pasta-active").get(0),K()),a(A.btn+".off").live("click",function(){var b;if(a(this).hasClass("on")){b=a(this),b.removeClass("on");return a(b.attr("href")).removeClass("copy-pasta-active")}u.load(),b=a(this),b.addClass("on");return h=a(b.attr("href")||"body").addClass("copy-pasta-active").get(0)}),a(A.btn+" .status").live("click",function(){var b;b=a(this).parent().attr("href")||"body",h=a(b).get(0),K();return false});if(M.addEventListener)return M.addEventListener("message",C,false);if(M.attachEvent)return M.attachEvent("onmessage",function(){return C(event)})},F=[{test:function(){if(M.jQuery&&M.jQuery.fn&&M.jQuery.fn.jquery>"1.3"){a=M.jQuery,k("Using existing jquery: version "+a.fn.jquery);return true}},src:"http://copypasta.heroku.com/javascripts/jquery-1.4.4.min.js",callback:function(){(e.$=a=M.jQuery).noConflict(1);return k("Loaded own jquery: version "+a.fn.jquery)}},{test:function(){return e.getElementCssPath&&M.jQuery&&M.jQuery.fn.lightbox_me},src:"http://copypasta.heroku.com/javascripts/utils.js"}],F.load=function(a,b){var d,e,f,g;f=function(){var b,c,d;d=[];for(b=0,c=a.length;b<c;b++)e=a[b],e.state||d.push(e);return d}();if(!(f.length===0)){d=f.pop(),d.state="pending",g=document.createElement("script"),g.type="text/javascript",g.src=d.src,g.onload=g.onreadystatechange=function(){var c,e;c=this.readyState;if(d.state!=="loaded"&&(!c||c==="loaded"||c==="complete")){d.state="loaded",d.callback&&d.callback(),f=function(){var b,c,d;d=[];for(b=0,c=a.length;b<c;b++)e=a[b],e.state!=="loaded"&&d.push(e);return d}();if(f.length===0)return b()}},a.length>0&&F.load(a,b);return c.appendChild(g)}},u=["translucent-blue.png","translucent-black.png","loading.gif"],u.load=function(){var a,b,c,d,e;e=[];for(c=0,d=u.length;c<d;c++)a=u[c],b=new Image,e.push(b.src=L+"/images/"+a);return e},B=function(){var a,b,c;c=[];for(a=0,b=F.length;a<b;a++)E=F[a],E&&!E.test()&&c.push(E);return c}(),B.length>0?F.load(B,w):w())}).call(this)