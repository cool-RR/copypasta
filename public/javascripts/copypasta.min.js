(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V;S=window;S.postMessage&&(c=function(){var a,b,c,d;c=document.documentElement.childNodes,d=[];for(a=0,b=c.length;a<b;a++)m=c[a],m.nodeType===1&&d.push(m);return d}()[0],y="https://copypasta.heroku.com",R="http://copypasta.heroku.com",g=document.createElement("link"),g.rel="stylesheet",g.href=R+"/stylesheets/compiled/copypasta.css",c.appendChild(g),a=false,i=false,h=false,r={},S.copypasta=f={$:false,page_id:S.copypasta_page_id},f.debug=S.copypasta_debug||S.location.hash.indexOf("copypasta-debug")>0,f.auto_start=S.copypasta_auto_start||S.location.hash.indexOf("copypasta-auto")>0,f.include_url_hash=S.copypasta_include_url_hash,f.content_selector=S.copypasta_content_selector,f.paragraph_threshold=S.copypasta_paragraph_threshold||3,f.character_threshold=S.copypasta_character_threshold||100,E=function(){var a,b,c,d,e,g,h,i;a=[],c=false,e=0,d=0,i=document.getElementsByTagName("p");for(g=0,h=i.length;g<h;g++)b=i[g],c!==b.parentElement&&(e>=f.paragraph_threshold||d>f.character_threshold?(a.push(c),k("Accepting container with "+e+" paragraphs and "+d+" characters.")):c&&k("Rejecting container with "+e+" paragraphs and "+d+" characters."),c=b.parentElement,e=0,d=b.innerText.length),e+=1,d+=b.innerText.length;e>=f.paragraph_threshold||d>f.character_threshold?(a.push(c),k("Accepting container with "+e+" paragraphs and "+d+" characters.")):c&&k("Rejecting container with "+e+" paragraphs and "+d+" characters.");return a},k=function(a){if(f.debug)return console.debug(a)},x={indicator:"copy-pasta-edit-indicator",dialog:"copy-pasta-dialog",iframe:"copy-pasta-iframe",overlay:"copy-pasta-overlay",btn:"copy-pasta-button",widget:"copy-pasta-widget"},F={indicator:"#"+x.indicator,dialog:"#"+x.dialog,btn:"#"+x.btn,active:".copy-pasta-active",iframe:"#"+x.iframe,overlay:"#"+x.overlay,status:"#copy-pasta-button .status",widget:"#"+x.widget},A=function(){a(F.indicator).length===0&&(a("body").append("<div id=\""+x.indicator+"\"><p>click to correct</p></div>"),a(F.indicator).bind("mouseout",j),a(F.indicator).bind("click",O));return a(F.indicator)},b=function(){var b,c;b=a(this).offset(),b.top=b.top+"px",b.left=b.left+"px",c={width:a(this).outerWidth()+"px",height:a(this).outerHeight()+"px"},A().css(c).css(b).show();return i=this},j=function(){A().hide();return i=false},T=function(c){return a(F.active+" "+c).live("mouseover",b)},q=function(){var b,c;b=S.location.hash,f.include_url_hash?S.location.hash=S.location.hash.replace(/#?copypasta-[a-z]+/g,""):S.location.hash="",c=a("link[rel=canonical]").attr("href")||S.location.href.replace(/#+$/,""),S.location.hash=b;return c},d=function(a){return"<div id=\""+x.dialog+"\" class=\""+a+"\"><div id=\""+x.overlay+"\"></div><iframe frameborder=\"no\" id=\""+x.iframe+"\" scrolling=\"no\"></iframe></div>"},N=function(){return a(F.overlay).fadeIn(function(){return k("Overlay shown")})},u=function(){return a(F.overlay).fadeOut(function(){return k("Overlay hidden")})},I=function(b,c){return a(b).animate({height:c.h})},O=function(){var a,b,c,d;m=i,(c=m.original_text)!=null?c:m.original_text=m.innerHTML,a=(d=f.page_id)!=null?d:"",r.new_edit={"edit[original]":m.original_text,"edit[proposed]":m.original_text,"edit[url]":q(),"edit[element_path]":f.getElementCssPath(m)},b=y+"/edits/new?view=framed&url="+escape(q())+"&page[key]="+escape(a);return M(b,"edit")},l={"default":{options:{escClose:true,overlayClose:true,overlayId:"copy-pasta-lightbox-overlay",containerId:"copy-pasta-lightbox-container",opacity:70,persist:true}},edit:{"class":"copy-pasta-lightbox"}},M=function(b,c){var e;a.fn.modal||f.modal_init(a);if(a.modal&&a("#copy-pasta-lightbox-container").length>0){a.modal.close();return setTimeout(function(){return M(b,c)},11)}e=l["default"],e.options.onShow=function(){if(b){a(F.overlay).show(),k("Overlay shown"),b=b,f.debug&&(b+="#debug"),k("Loading iframe: "+b);return a(F.iframe).attr("src",b)}},c&&l[c]&&(e=l[c],e.options||(e.options={}),e.extended||(e.options=a.extend(e.options,l["default"].options)),e.extended=true);return a.modal(d(e["class"]),e.options)},V=function(){var a,b,c;a=(c=f.page_id)!=null?c:"";return b=y+"/edits?view=framed&url="+escape(q())+"&page[key]="+escape(a)},e="<div id=\""+x.widget+"\"><h1>copypasta</h1><iframe frameborder=\"no\" scrolling=\"no\"></iframe></div>",U=function(b){a(F.widget).length===0&&(a("body").append(e),b==null&&(b=V())),b!=null&&a(F.widget).find("iframe").attr("src",b);return a(F.widget).show()},P=function(b){var c,d,e;k("Previewing "+b.element_path),e=a(b.element_path),c=e.position(),e.get(0).original_text||(e.get(0).original_text=e.html()),d=a("html").scrollTop(1)>0?"html":"body";return a(d).animate({scrollTop:c.top},function(){return e.html(b.proposed).addClass("copy-pasta-preview")})},v=function(b){var c;c=a(b);return c.removeClass("copy-pasta-preview").html(c.get(0).original_text)},w=function(){return a(".copy-pasta-preview").each(function(){var b,c;b=(c=this.original_text)!=null?c:a(this).html();return a(this).removeClass("copy-pasta-preview").html(b)})},C=function(b){var c,d,e,f;d=a(window).scrollTop(),c=d+a(window).height(),f=a(b).offset().top,e=f+a(b).height();return e>=d&&f<=c&&e<=c&&f>=d},D=function(a){if(a&&r[a])return L({label:"form_data",data:r[a]})},L=function(b){k("Parent send: "+b.label+" to "+y),b=JSON.stringify(b);return a(F.iframe).get(0).contentWindow.postMessage(b,y)},H=function(a){var b;if(a.origin!==y)k(a);else{b=JSON.parse(a.data),k("Parent receive: "+b.label+" from "+a.origin+" for frame type: "+b.frame_type);return b.frame_type==="dialog"?s(b):t(b)}},t=function(a){if(a.label==="resize")return I(F.widget+" iframe",a);if(a.label==="finished")return p();if(a.label==="preview")return P(a);if(a.label==="preview-off")return v(a.element_path)},s=function(b){if(b.label==="ready"){if(!D(b.form_id))return u()}else{if(b.label==="form_data_loaded")return u();if(b.label==="finished"){a.modal&&a.modal.close(),w();return U(V())}if(b.label==="resize")return I(F.dialog,b)}},o="p, h1, h2, h3, h4, h5, td, th, li",n=function(a){if(!(a instanceof HTMLAnchorElement)){i=this,O();return false}},f.start_editing=Q=function(){var b;z.load(),a(F.btn).addClass("on"),b=a(h).addClass("copy-pasta-active").find(o).filter(":visible"),b.addClass("copy-pasta-editable").bind("click",n);return U()},p=function(){a(F.btn).removeClass("on"),w(),a(h).removeClass("copy-pasta-active"),a(".copy-pasta-editable").removeClass("copy-pasta-editable").unbind("click",n);return U().remove()},B=function(){f.content_selector?h=a(f.content_selector):h=a(E()),f.auto_start&&Q(),a(F.btn).live("click",function(){return a(this).hasClass("on")?p():Q()}),a(F.btn+" .status").live("click",function(){return false});if(S.addEventListener)return S.addEventListener("message",H,false);if(S.attachEvent)return S.attachEvent("onmessage",function(){return H(event)})},K=[{test:function(){if(S.jQuery&&S.jQuery.fn&&S.jQuery.fn.jquery>"1.3"){f.$=a=S.jQuery,k("Using existing jquery: version "+a.fn.jquery);return true}},src:"http://copypasta.heroku.com/javascripts/jquery-1.4.4.min.js",callback:function(){(f.$=a=S.jQuery).noConflict(1);return k("Loaded own jquery: version "+a.fn.jquery)}},{test:function(){return f.getElementCssPath&&S.jQuery&&S.jQuery.fn.lightbox_me},src:"http://copypasta.heroku.com/javascripts/utils.js"}],K.load=function(a,b){var d,e,f,g;f=function(){var b,c,d;d=[];for(b=0,c=a.length;b<c;b++)e=a[b],e.state||d.push(e);return d}();if(!(f.length===0)){d=f.pop(),d.state="pending",g=document.createElement("script"),g.type="text/javascript",g.src=d.src,g.onload=g.onreadystatechange=function(){var c,e;c=this.readyState;if(d.state!=="loaded"&&(!c||c==="loaded"||c==="complete")){d.state="loaded",d.callback&&d.callback(),f=function(){var b,c,d;d=[];for(b=0,c=a.length;b<c;b++)e=a[b],e.state!=="loaded"&&d.push(e);return d}();if(f.length===0)return b()}},a.length>0&&K.load(a,b);return c.appendChild(g)}},z=["translucent-blue.png","translucent-black.png","loading.gif","pencil.png"],z.load=function(){var a,b,c,d,e;e=[];for(c=0,d=z.length;c<d;c++)a=z[c],b=new Image,e.push(b.src=R+"/images/"+a);return e},G=function(){var a,b,c;c=[];for(a=0,b=K.length;a<b;a++)J=K[a],J&&!J.test()&&c.push(J);return c}(),G.length>0?K.load(G,B):B())}).call(this)