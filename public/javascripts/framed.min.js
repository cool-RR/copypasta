(function(){var a,b,c,d,e,f,g,h;a=window.jQuery,b=window.location.hash.indexOf("debug")>0,c=function(a){if(b)return console.debug(a)},g=function(){var b;b={label:"resize",h:a("html").height()};return h(b)},h=function(b){c("Frame send: "+b.label+" to "+parent_url),b.frame_type=a("body").attr("class"),b=JSON.stringify(b);return parent.postMessage(b,parent_url)},d=function(b){a("form input, form textarea").each(function(){var c;c=a(this).attr("name");if(c in b)return a(this).val(b[c])});return h({label:"form_data_loaded"})},f=function(a){var b;if(parent_url.indexOf(a.origin)!==0)c(a);else{b=JSON.parse(a.data),c("Frame receive: "+b.label+" from "+a.origin);if(b.label==="form_data")return d(b.data)}},e=function(){window.addEventListener!=null?window.addEventListener("message",f,false):window.attachEvent!=null&&window.attachEvent("onmessage",function(){return f(event)}),h({label:"ready",form_id:a("form.primary").attr("id")});return g()},a(".close").live("click",function(){return h({label:"finished"})}),a("input.edit-preview-toggle").live("change",function(){return this.checked?h({label:"preview",proposed:a(this).val(),element_path:a(this).parent().find(".element_path").val()}):h({label:"preview-off",element_path:a(this).parent().find(".element_path").val()})}),a("form.editor-options input").live("change",function(){var b;b=this;return a(this).closest("tr").fadeOut(function(){return a(b).closest("form").submit()})}),a("input.back").live("click",function(){return history.go(-1)}),a(e)}).call(this)