(function(){var a,b,c,d,e,f,g,h,i;a=window.jQuery,b=window.location.hash.indexOf("debug")>0,c=function(a){if(b&&console&&console.log)return console.log(a)},h=function(){var b;b={label:"resize",h:a("html").height()};return i(b)},i=function(b){c("Frame send: "+b.label+" to "+parent_url),b.frame_type||(b.frame_type=a("body").attr("class")),b=JSON.stringify(b);return parent.postMessage(b,parent_url)},d=function(b){a("form input, form textarea").each(function(){var c;c=a(this).attr("name");if(c in b)return a(this).val(b[c])});return i({label:"form_data_loaded"})},g=function(a){var b;if(parent_url.indexOf(a.origin)!==0)c(a);else{b=JSON.parse(a.data),c("Frame receive: "+b.label+" from "+a.origin);if(b.label==="form_data")return d(b.data)}},e=function(){window.addEventListener!=null?window.addEventListener("message",g,!1):window.attachEvent!=null&&window.attachEvent("onmessage",function(){return g(event)}),i({label:"ready",form_id:a("form.primary").attr("id")});return h()},a(".close").live("click",function(){var b;b={label:"finished"},(b.frame_type=a("body").attr("class"))==="dialog"&&a(".success").length>0&&(b.reload_widget=!0);return i(b)}),f=!1,a("input.edit-preview-toggle").live("click",function(){f&&i({label:"preview-off",element_path:f}),f=a(this).parent().find(".element_path").val();return i({label:"preview",proposed:a(this).val(),element_path:f})}),a("form.editor-options input").live("change",function(){i({label:"loading"});return a(this).closest("form").submit()}),a("input.back").live("click",function(){return history.go(-1)}),a(e)}).call(this)